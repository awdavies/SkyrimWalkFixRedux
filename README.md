For pre-1.6.640 versions, check out 684b94efc94fb779a92da3d5799b7c6e8cf14421 from submodule.
